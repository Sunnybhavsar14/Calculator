<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Calculator — HTML CSS JS</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <main class="calculator" role="application" aria-label="Calculator">
    <div class="screen" aria-hidden="false">
      <div class="history" id="history" aria-live="polite"></div>
      <div class="output" id="output" role="textbox" aria-live="assertive">0</div>
    </div>

    <div class="pad">
      <button class="clear" data-action="clear">C</button>
      <button data-action="toggle-sign">±</button>
      <button data-action="percent">%</button>
      <button class="operation" data-action="operator">÷</button>

      <button data-num>7</button>
      <button data-num>8</button>
      <button data-num>9</button>
      <button class="operation" data-action="operator">×</button>

      <button data-num>4</button>
      <button data-num>5</button>
      <button data-num>6</button>
      <button class="operation" data-action="operator">−</button>

      <button data-num>1</button>
      <button data-num>2</button>
      <button data-num>3</button>
      <button class="operation" data-action="operator">+</button>

      <button class="span2" data-num>0</button>
      <button data-num>.</button>
      <button class="equal" data-action="equals">=</button>
    </div>

    <div class="hint">Keyboard: numbers, + - * /, Enter =, Backspace to delete</div>
  </main>

  <script>
    (function(){
      const outputEl = document.getElementById('output');
      const historyEl = document.getElementById('history');

      let current = '0';
      let previous = null;
      let operator = null;
      let justEvaluated = false;

      function updateDisplay(){
        outputEl.textContent = current;
      }

      function appendNumber(n){
        if(justEvaluated){ current = '0'; justEvaluated = false; }
        if(n === '.' && current.includes('.')) return;
        if(current === '0' && n !== '.') current = n;
        else current = current + n;
        updateDisplay();
      }

      function chooseOperator(op){
        if(operator && !justEvaluated){ compute(); }
        previous = current;
        operator = op;
        current = '0';
        updateHistory();
      }

      function updateHistory(){
        historyEl.textContent = previous ? `${previous} ${operator || ''}` : '';
      }

      function compute(){
        if(previous == null || !operator) return;
        const a = parseFloat(previous);
        const b = parseFloat(current);
        let res = 0;
        switch(operator){
          case '+': res = a + b; break;
          case '−': res = a - b; break;
          case '×': res = a * b; break;
          case '÷': res = b === 0 ? 'Error' : a / b; break;
          default: res = b;
        }
        current = String(res);
        previous = null;
        operator = null;
        justEvaluated = true;
        updateHistory();
        updateDisplay();
      }

      function clearAll(){ current = '0'; previous = null; operator = null; justEvaluated = false; updateHistory(); updateDisplay(); }

      function percent(){
        const val = parseFloat(current);
        if(isNaN(val)) return;
        current = String(val / 100);
        updateDisplay();
      }

      function toggleSign(){
        if(current === '0') return;
        current = String(parseFloat(current) * -1);
        updateDisplay();
      }

      // button handling
      document.querySelectorAll('button').forEach(btn => {
        btn.addEventListener('click', () => {
          const num = btn.getAttribute('data-num');
          const action = btn.getAttribute('data-action');
          if(num != null) appendNumber(num);
          else if(action === 'clear') clearAll();
          else if(action === 'percent') percent();
          else if(action === 'toggle-sign') toggleSign();
          else if(action === 'operator') chooseOperator(btn.textContent.trim());
          else if(action === 'equals') compute();
        });
      });

      // keyboard support
      window.addEventListener('keydown', (e) => {
        if(e.key >= '0' && e.key <= '9') { appendNumber(e.key); e.preventDefault(); }
        else if(e.key === '.') appendNumber('.');
        else if(e.key === 'Enter' || e.key === '=') { compute(); e.preventDefault(); }
        else if(e.key === '+' || e.key === '-') { chooseOperator(e.key === '-' ? '−' : '+'); e.preventDefault(); }
        else if(e.key === '*') { chooseOperator('×'); e.preventDefault(); }
        else if(e.key === '/') { chooseOperator('÷'); e.preventDefault(); }
        else if(e.key === 'Backspace'){
          if(justEvaluated) { clearAll(); }
          else {
            current = current.length > 1 ? current.slice(0,-1) : '0';
            updateDisplay();
          }
        }
      });

      // initialize
      updateDisplay();
    })();
  </script>
</body>
</html>
